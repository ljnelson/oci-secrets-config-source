<!DOCTYPE html>


<!--
 | Generated by Apache Maven Doxia Site Renderer 2.0.0-M3 from src/site/markdown/index.md.vm at 2022-07-29
 | Rendered using Apache Maven Fluido Skin 1.11.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 2.0.0-M3" />
    <title>OCI Secrets ConfigSource &#x2013; OCI Secrets ConfigSource</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.11.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script src="./js/apache-maven-fluido-1.11.0.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><a href="https://github.com/ljnelson/oci-secrets-config-source/" id="bannerLeft"><h1>OCI Secrets ConfigSource</h1>
</a></div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2022-07-29</li>
      <li id="projectVersion" class="pull-right">Version: 0.0.6</li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Documentation</li>
    <li class="active"><a><span class="none"></span>Overview</a></li>
    <li><a href="apidocs/index.html" title="JavaDocs"><span class="none"></span>JavaDocs</a></li>
    <li><a href="https://github.com/ljnelson/oci-secrets-config-source/" class="externalLink" title="Github Repository"><span class="none"></span>Github Repository</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-down"></span>Project Information</a>
     <ul class="nav nav-list">
      <li><a href="dependencies.html" title="Dependencies"><span class="none"></span>Dependencies</a></li>
      <li><a href="dependency-info.html" title="Dependency Information"><span class="none"></span>Dependency Information</a></li>
      <li><a href="dependency-management.html" title="Dependency Management"><span class="none"></span>Dependency Management</a></li>
      <li><a href="distribution-management.html" title="Distribution Management"><span class="none"></span>Distribution Management</a></li>
      <li class="active"><a><span class="none"></span>About</a></li>
      <li><a href="issue-management.html" title="Issue Management"><span class="none"></span>Issue Management</a></li>
      <li><a href="licenses.html" title="Licenses"><span class="none"></span>Licenses</a></li>
      <li><a href="plugin-management.html" title="Plugin Management"><span class="none"></span>Plugin Management</a></li>
      <li><a href="plugins.html" title="Plugins"><span class="none"></span>Plugins</a></li>
      <li><a href="scm.html" title="Source Code Management"><span class="none"></span>Source Code Management</a></li>
      <li><a href="summary.html" title="Summary"><span class="none"></span>Summary</a></li>
      <li><a href="team.html" title="Team"><span class="none"></span>Team</a></li>
     </ul></li>
    <li><a href="project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<section>
<h1><a name="OCI_Secrets_ConfigSource"></a>OCI Secrets ConfigSource</h1><section>
<h2><a name="Status"></a>Status</h2>
<p>Experimental and unsupported and not Oracle software.</p></section><section>
<h2><a name="Gist"></a>Gist</h2>
<p>This project is a sort of compositional toolkit for assembling a
<code>org.eclipse.microprofile.config.spi.ConfigSource</code> that knows how to
<a href="https://docs.oracle.com/en-us/iaas/tools/java/latest/com/oracle/bmc/secrets/Secrets.html#getSecretBundle-com.oracle.bmc.secrets.requests.GetSecretBundleRequest-" class="externalLink">get a property value from an OCI
secret</a>.</p>
<p>In your project:</p>
<ol style="list-style-type: decimal">

<li>Subclass <code>io.github.ljnelson.oci.secrets.configsource.SecretBundleConfigSource</code>.</li>
<li>Give it a <code>public</code> zero-argument constructor.</li>
<li>In that constructor, call <code>super()</code> with appropriate arguments.
See
<code>io.github.ljnelson.oci.secrets.configsource.SimpleSecretsSupplier</code>
and
<code>io.github.ljnelson.oci.secrets.configsource.SelectiveBuilderFunction</code>
as examples.</li>
<li>Edit
<code>src/main/resources/META-INF/services/org.eclipse.microprofile.config.spi.ConfigSource</code>
to contain a line with the fully qualified name of your subclass.</li>
<li>Put your project's jar file on the runtime classpath.  It will now be used.</li>
</ol>
<p>Because this toolkit is compositional, it's virtually impossible to
list all the possible ways you can use it.</p></section><section>
<h2><a name="Structure"></a>Structure</h2>
<p>The actual <code>ConfigSource</code> implementation is
<code>SecretBundleConfigSource</code>.  It is not abstract, but it requires a
couple of constructor arguments, so (by design) cannot be used itself
as a <code>java.util.ServiceLoader</code>-compatible service provider.</p>
<p>This class takes a <code>Supplier</code> that knows how to return
<code>com.oracle.bmc.secrets.Secrets</code> instances.  It uses
<code>SimpleSecretsSupplier</code> if none is supplied, which uses a bunch of OCI
defaults and authentication information from your <code>~/.oci/config</code> file.</p>
<p>It also takes a <code>Function</code> that, when supplied with a MicroProfile
Config property name, returns a configured
<code>GetSecretBundleRequest.Builder</code>, or <code>null</code> if the property name is
not handled.</p>
<p>Each of these two parameters may be implemented however you like.  The
rest of the toolkit exists to make supplying these two arguments
relatively simple.</p>
<p>The toolkit comes with the <code>SelectiveBuilderFunction</code> class, which
wraps a delegate builder function with a <code>Predicate</code>, so that the
delegate builder function is invoked only for valid property names
that are intended to be handled.  It's like a property name filter.</p>
<p>The toolkit also comes with a <code>ConfigurationBackedBuilderFunction</code>.
This uses MicroProfile Config, or any <code>BiFunction</code> capable of
returning an optional value when given a string and a type, to make a
<code>GetSecretBundleRequest.Builder</code> out of configuration values.  It may
be used, or it may not, depending on your use cases.  It does no
filtering of any kind so you typically use it in conjunction with the
<code>SelectiveBuilderFunction</code> above.  Or, if you know you want to source
every last living single MicroProfile Config property on earth from a
vault, who am I to say otherwise?  Vaya con Dios.</p></section><section>
<h2><a name="Example"></a>Example</h2>
<p>Here is a bare-bones example of a <code>ConfigSource</code> implementation built
from parts of this toolkit that will handle any MicroProfile Config
request for the <code>someSensitivePropertyName</code> property, provided that
there is an <code>~/.oci/config</code> file and a value for
<code>someSensitivePropertyName.secretId</code> set as well in the MicroProfile
Config universe:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">package example;

import io.github.ljnelson.oci.secrets.configsource.ConfigurationBackedBuilderFunction;
import io.github.ljnelson.oci.secrets.configsource.SecretBundleConfigSource;
import io.github.ljnelson.oci.secrets.configsource.SelectiveBuilderFunction;

public class ExampleSecretBundleConfigSource extends SecretBundleConfigSource {

  public ExampleSecretBundleConfigSource() {
    super(new SelectiveBuilderFunction(&quot;someSensitivePropertyName&quot;,
                                       new ConfigurationBackedBuilderFunction()));
  }

}
</code></pre></div>
<p>If you edit <code>src/main/resources/META-INF/services/org.eclipse.microprofile.config.spi.ConfigSource</code> so that it contains a line like this:</p>

<div class="source"><pre class="prettyprint"><code>example.ExampleSecretBundleConfigSource
</code></pre></div>
<p>&#x2026;then the example above, when present in a jar file on the runtime
classpath, will be used by MicroProfile Config as just another config
source.</p>
<p>If you then set, for example, a system property like this:</p>

<div class="source"><pre class="prettyprint"><code class="language-shell">-DsomeSensitivePropertyName.secretId=ocid1.vaultsecret.oc1.iad... # i.e. a valid OCID to a secret
</code></pre></div>
<p>&#x2026;then any time a developer or a library or any code anywhere does
this:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">String s = ConfigProvider.getConfig().getPropertyValue(&quot;someSensitivePropertyName&quot;, String.class);
</code></pre></div>
<p>&#x2026;or this:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">@Inject
@ConfigProperty(&quot;someSensitivePropertyName&quot;)
private String s;
</code></pre></div>
<p>&#x2026;she will get the value of the secret in your vault named
<code>someSensitivePropertyName</code>.</p>
<p>The <code>.secretId</code> suffix (and other ones) is not magic; it is just a
thing that <code>ConfigurationBackedBuilderFunction</code> uses.  You can write
your own function to do something different.</p></section></section>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>&#169;      2022
<a href="https://ljnelson.github.io/">Laird Nelson</a>
</p>
        </div>
      </div>
    </footer>
<script>
	if(anchors) {
	  anchors.add();
	}
</script>
  </body>
</html>